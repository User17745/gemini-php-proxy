<input type="file" id="imageInput" accept="image/*" />
<input type="text" id="promptInput" placeholder="Say something..." />
<button onclick="submitPrompt()">Send</button>
<pre id="response"></pre>

<script>
async function submitPrompt() {
  const prompt = document.getElementById('promptInput').value;
  const file = document.getElementById('imageInput').files[0];

  if (!prompt || prompt.trim() === '') {
    document.getElementById('response').textContent = 'Prompt is required and must be a non-empty string.';
    return;
  }

  const parts = [{ text: prompt.trim() }];

  if (file) {
    const base64 = await toBase64(file);
    parts.push({
      inlineData: {
        mimeType: file.type,
        data: base64.split(',')[1] // remove "data:image/jpeg;base64,"
      }
    });
  }

  const payload = {
    prompt: prompt.trim(),
    contents: parts
  };

  try {
    const res = await fetch('https://abhiai.greenhonchos.in/index.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      throw new Error(`HTTP error! status: ${res.status}`);
    }

    const data = await res.json();
    document.getElementById('response').textContent =
      data?.candidates?.[0]?.content?.parts?.[0]?.text || 'No response.';
  } catch (error) {
    document.getElementById('response').textContent = `Error: ${error.message}`;
  }
}

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
</script>